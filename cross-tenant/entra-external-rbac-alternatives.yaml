# Generated by Copilot
#  ------------------------------------------------------------
#   Copyright (c) Microsoft Corporation.  All rights reserved.
#   Licensed under the MIT License (MIT). See License.txt in the repo root for license information.
#  ------------------------------------------------------------

# RBAC Configuration for Entra ID External Users
# This file provides alternative configurations for different scenarios

---
# Configuração 1: RBAC com grupo Entra ID (configuração atual)
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: entra-external-cluster-admins
  annotations:
    description: "Cluster admin access for Entra ID External group"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
  - kind: Group
    name: 93ae7ed7-8077-4ed4-9947-ca3e991a253f
    apiGroup: rbac.authorization.k8s.io

---
# Configuração 2: RBAC alternativo para usuário específico (caso o grupo não funcione)
# Descomente e substitua USER_OBJECT_ID pelo Object ID do usuário
# apiVersion: rbac.authorization.k8s.io/v1
# kind: ClusterRoleBinding
# metadata:
#   name: entra-external-user-admin
#   annotations:
#     description: "Cluster admin access for specific Entra ID External user"
# roleRef:
#   apiGroup: rbac.authorization.k8s.io
#   kind: ClusterRole
#   name: cluster-admin
# subjects:
#   - kind: User
#     name: USER_OBJECT_ID
#     apiGroup: rbac.authorization.k8s.io

---
# Configuração 3: Namespace-scoped admin (mais seguro)
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: entra-external-namespace-admin
  namespace: default
  annotations:
    description: "Namespace admin access for Entra ID External group"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: admin
subjects:
  - kind: Group
    name: 93ae7ed7-8077-4ed4-9947-ca3e991a253f
    apiGroup: rbac.authorization.k8s.io

---
# Configuração 4: Custom Role com permissões específicas
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: entra-external-custom-role
  annotations:
    description: "Custom role for Entra ID External users with specific permissions"
rules:
  - apiGroups: [""]
    resources: ["nodes", "pods", "services", "endpoints"]
    verbs: ["get", "list", "watch"]
  - apiGroups: ["apps"]
    resources: ["deployments", "replicasets"]
    verbs: ["get", "list", "watch", "create", "update", "patch", "delete"]
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["get", "list", "watch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: entra-external-custom-binding
  annotations:
    description: "Binding for custom Entra ID External role"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: entra-external-custom-role
subjects:
  - kind: Group
    name: 93ae7ed7-8077-4ed4-9947-ca3e991a253f
    apiGroup: rbac.authorization.k8s.io

---
# Configuração 5: ServiceAccount para aplicações (se necessário)
apiVersion: v1
kind: ServiceAccount
metadata:
  name: entra-external-service-account
  namespace: default
  annotations:
    description: "Service account for applications using Entra ID External"

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: entra-external-service-account-binding
  annotations:
    description: "Binding for Entra ID External service account"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: view
subjects:
  - kind: ServiceAccount
    name: entra-external-service-account
    namespace: default
