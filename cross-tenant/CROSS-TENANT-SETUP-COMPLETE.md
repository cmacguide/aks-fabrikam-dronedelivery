# ‚úÖ CONFIGURA√á√ÉO CROSS-TENANT RBAC CONCLU√çDA

## üìã Resumo da Configura√ß√£o

### üéØ Objetivo Alcan√ßado

- **Tenant Principal (83d6df9e-eec5-4d37-be60-97bf712d85ab)**: Recursos do AKS
- **Tenant Entra ID External (cdbba3b9-3344-40cd-9f2d-5a463efc272d)**: Usu√°rios e grupos RBAC

### ‚úÖ Configura√ß√µes Realizadas

#### 1. Grupo Criado no Entra ID External

- **Nome**: dronedelivery-cluster-admin
- **Group ID**: `93ae7ed7-8077-4ed4-9947-ca3e991a253f`
- **Descri√ß√£o**: Administradores do cluster AKS Fabrikam via Entra ID External
- **Membro Atual**: Cmac JR (jrcarlosmachado_gmail.com#EXT#@bimoptimize.onmicrosoft.com)

#### 2. Arquivos de Configura√ß√£o Gerados

- ‚úÖ `azuredeploy.parameters.cross-tenant.json` - Par√¢metros para deploy
- ‚úÖ `deploy-cross-tenant-aks.sh` - Script automatizado de deploy
- ‚úÖ Template Bicep j√° configurado corretamente

#### 3. Template Bicep Validado

O arquivo `cluster-stamp.bicep` j√° possui a configura√ß√£o correta:

```bicep
aadProfile: {
  managed: true
  adminGroupObjectIDs: [
    k8sRbacEntraAdminGroupObjectID  // 93ae7ed7-8077-4ed4-9947-ca3e991a253f
  ]
  tenantID: k8sRbacEntraProfileTenantId  // cdbba3b9-3344-40cd-9f2d-5a463efc272d
}
```

## üöÄ Pr√≥ximos Passos

### 1. Deploy do AKS com Cross-Tenant RBAC

```bash
# Execute o script de deploy automatizado
./deploy-cross-tenant-aks.sh
```

### 2. Teste de Acesso para Usu√°rios Entra ID External

#### Login no Tenant Entra ID External:

```bash
# Login especificando o tenant correto
az login --tenant cdbba3b9-3344-40cd-9f2d-5a463efc272d
```

#### Obter Credenciais do Cluster:

```bash
# Mudar para subscription do tenant principal
az account set --subscription <SUBSCRIPTION_ID>

# Obter credenciais do cluster
az aks get-credentials \
  --resource-group rg-shipping-dronedelivery \
  --name <AKS_CLUSTER_NAME> \
  --overwrite-existing
```

#### Validar Acesso:

```bash
# Teste b√°sico
kubectl get nodes

# Verificar identidade
kubectl auth whoami
```

### 3. Adicionar Novos Usu√°rios

Para adicionar mais usu√°rios ao grupo:

```bash
# Login no tenant Entra ID External
az login --tenant cdbba3b9-3344-40cd-9f2d-5a463efc272d

# Adicionar usu√°rio ao grupo
az ad group member add \
  --group "93ae7ed7-8077-4ed4-9947-ca3e991a253f" \
  --member-id <USER_OBJECT_ID>
```

## üîç Compara√ß√£o de Configura√ß√µes

### Configura√ß√£o Atual (azuredeploy.parameters.prod.json)

```json
{
  "k8sRbacEntraAdminGroupObjectID": {
    "value": "[guid]" // Valor gen√©rico
  },
  "k8sRbacEntraProfileTenantId": {
    "value": "[guid]" // Valor gen√©rico
  }
}
```

### Nova Configura√ß√£o Cross-Tenant

```json
{
  "k8sRbacEntraAdminGroupObjectID": {
    "value": "93ae7ed7-8077-4ed4-9947-ca3e991a253f" // Grupo espec√≠fico
  },
  "k8sRbacEntraProfileTenantId": {
    "value": "cdbba3b9-3344-40cd-9f2d-5a463efc272d" // Tenant External
  }
}
```

## üõ°Ô∏è Benef√≠cios da Configura√ß√£o

1. **Separa√ß√£o de Responsabilidades**: Identidades gerenciadas separadamente dos recursos
2. **Gest√£o Centralizada**: Usu√°rios externos em tenant dedicado
3. **Seguran√ßa Aprimorada**: Isolamento entre ambientes
4. **Flexibilidade**: Facilita gest√£o de usu√°rios tempor√°rios/externos
5. **Compliance**: Separa√ß√£o clara entre ambientes de produ√ß√£o e identidades

## üìû Suporte

Esta configura√ß√£o segue as melhores pr√°ticas da Microsoft para Cross-Tenant RBAC no AKS.

**Documenta√ß√£o de refer√™ncia:**

- [AKS AAD Integration](https://learn.microsoft.com/en-us/azure/aks/managed-aad)
- [Cross-tenant RBAC](https://learn.microsoft.com/en-us/azure/role-based-access-control/cross-tenant-rbac)

<!-- Generated by Copilot -->
