#!/bin/bash
# Generated by Copilot
# Script simples para gerenciar vari√°veis azd

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

log_info() { echo -e "${BLUE}‚ÑπÔ∏è  $1${NC}"; }
log_success() { echo -e "${GREEN}‚úÖ $1${NC}"; }
log_warning() { echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"; }
log_error() { echo -e "${RED}‚ùå $1${NC}"; }
log_header() { echo -e "${CYAN}$1${NC}"; }

echo ""
log_header "=================================================="
log_header "  üöÄ Gerenciador de Vari√°veis Azure Developer CLI"
log_header "=================================================="
echo ""

# Verifica azd
if ! command -v azd &> /dev/null; then
    log_error "Azure Developer CLI (azd) n√£o est√° instalado!"
    exit 1
fi

# Mostra ambiente atual
current_env=$(azd env list | grep "true" | awk '{print $1}' | head -1)
log_info "Ambiente ativo: $current_env"
echo ""

# Fun√ß√£o para listar vari√°veis
list_vars() {
    log_header "=== Vari√°veis Existentes ==="
    azd env get-values | while IFS='=' read -r key value; do
        clean_value=$(echo "$value" | sed 's/^"//;s/"$//')
        printf "  %-35s = %s\n" "$key" "$clean_value"
    done
    echo ""
}

# Fun√ß√£o para definir vari√°vel
set_var() {
    local var_name="$1"
    local var_value="$2"
    
    if azd env set "$var_name" "$var_value"; then
        log_success "Vari√°vel '$var_name' definida com sucesso!"
        return 0
    else
        log_error "Erro ao definir a vari√°vel '$var_name'"
        return 1
    fi
}

# Menu interativo
while true; do
    echo ""
    log_header "=== Op√ß√µes ==="
    echo "1. Listar vari√°veis existentes"
    echo "2. Definir nova vari√°vel"
    echo "3. Preset Fabrikam (vari√°veis padr√£o)"
    echo "4. Sair"
    echo ""
    
    read -p "Escolha uma op√ß√£o (1-4): " opcao
    
    case $opcao in
        1)
            list_vars
            ;;
        2)
            echo ""
            read -p "Nome da vari√°vel: " var_name
            read -p "Valor da vari√°vel: " var_value
            
            if [ -n "$var_name" ] && [ -n "$var_value" ]; then
                set_var "$var_name" "$var_value"
            else
                log_warning "Nome e valor n√£o podem estar vazios!"
            fi
            ;;
        3)
            echo ""
            log_header "=== Configurando Preset Fabrikam ==="
            
            # Vari√°veis espec√≠ficas do projeto
            declare -a preset_vars=(
                "DOMAIN_NAME=fabrikam.com"
                "ENVIRONMENT_NAME=dev"
                "KUBERNETES_VERSION=1.30.12"
            )
            
            log_info "Configurando vari√°veis padr√£o do projeto..."
            
            for var in "${preset_vars[@]}"; do
                IFS='=' read -r name value <<< "$var"
                echo "Definindo: $name = $value"
                set_var "$name" "$value"
            done
            
            log_success "Preset configurado!"
            ;;
        4)
            log_success "Saindo..."
            break
            ;;
        *)
            log_warning "Op√ß√£o inv√°lida! Escolha entre 1-4."
            ;;
    esac
done
